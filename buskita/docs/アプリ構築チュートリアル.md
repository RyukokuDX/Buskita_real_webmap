# ãƒã‚¹ã‚­ã‚¿APIç‹¬è‡ªã‚¢ãƒ—ãƒªæ§‹ç¯‰ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€ãƒã‚¹ã‚­ã‚¿APIç ”ç©¶ã®æˆæœã‚’æ´»ç”¨ã—ã¦ã€ç‹¬è‡ªã®ãƒã‚¹ä½ç½®è¿½è·¡ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’æ®µéšçš„ã«èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [äº‹å‰æº–å‚™](#äº‹å‰æº–å‚™)
2. [APIç†è§£ãƒ•ã‚§ãƒ¼ã‚º](#apiç†è§£ãƒ•ã‚§ãƒ¼ã‚º)
3. [åŸºæœ¬ã‚¢ãƒ—ãƒªæ§‹ç¯‰](#åŸºæœ¬ã‚¢ãƒ—ãƒªæ§‹ç¯‰)
4. [é«˜åº¦ãªæ©Ÿèƒ½å®Ÿè£…](#é«˜åº¦ãªæ©Ÿèƒ½å®Ÿè£…)
5. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
6. [å‚è€ƒè³‡æ–™](#å‚è€ƒè³‡æ–™)

## ğŸš€ äº‹å‰æº–å‚™

### å¿…è¦ãªçŸ¥è­˜
- PythonåŸºç¤çŸ¥è­˜
- REST API ã®åŸºæœ¬æ¦‚å¿µ
- JSON ãƒ‡ãƒ¼ã‚¿å‡¦ç†
- Webé–‹ç™ºã®åŸºç¤ï¼ˆHTML/CSS/JavaScriptï¼‰

### ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd buskita
```

## ğŸ” APIç†è§£ãƒ•ã‚§ãƒ¼ã‚º

### ã‚¹ãƒ†ãƒƒãƒ—1: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç†è§£

ã¾ãšã€ç™ºè¦‹ã•ã‚ŒãŸ11å€‹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚

ğŸ“– **è©³ç´°ã‚¬ã‚¤ãƒ‰**: [API_USAGE_SUMMARY.md](./API_USAGE_SUMMARY.md)

**ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
- `get-bus` - ç‰¹å®šãƒã‚¹ã®ä½ç½®æƒ…å ±
- `get-buses` - å…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¹ä¸€è¦§
- `get-companies-dictionary` - ãƒã‚¹ä¼šç¤¾æƒ…å ±
- `get-landmarks-dictionary` - ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æƒ…å ±

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒã‚¹IDå–å¾—ã‚·ã‚¹ãƒ†ãƒ ã®ç†è§£

ãƒã‚¹ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®2ã¤ã®IDç³»çµ±ã‚’ç†è§£ã—ã¾ã™ã€‚

ğŸ“– **è©³ç´°ã‚¬ã‚¤ãƒ‰**: [ãƒã‚¹IDå–å¾—å®Œå…¨ã‚¬ã‚¤ãƒ‰.md](./ãƒã‚¹IDå–å¾—å®Œå…¨ã‚¬ã‚¤ãƒ‰.md)

**IDç¨®é¡:**
- `workNo`: æ•°å€¤IDï¼ˆä¾‹: 291940ï¼‰
- `device_uid`: æ–‡å­—åˆ—IDï¼ˆä¾‹: "jhb_5379914"ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—3: æŠ€è¡“ä»•æ§˜ã®ç†è§£

ãƒã‚¹ã‚­ã‚¿ã‚¢ãƒ—ãƒªã®æŠ€è¡“çš„èƒŒæ™¯ã‚’ç†è§£ã—ã¾ã™ã€‚

ğŸ“– **è©³ç´°ã‚¬ã‚¤ãƒ‰**: [ãƒã‚¹ã‚­ã‚¿ã‚¢ãƒ—ãƒªæŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ.md](./ãƒã‚¹ã‚­ã‚¿ã‚¢ãƒ—ãƒªæŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ.md)

## ğŸ—ï¸ åŸºæœ¬ã‚¢ãƒ—ãƒªæ§‹ç¯‰

### ã‚¹ãƒ†ãƒƒãƒ—4: åŸºæœ¬çš„ãªãƒã‚¹è¿½è·¡ã‚¢ãƒ—ãƒª

æœ€åˆã«ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚¹ä½ç½®è¿½è·¡ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```python
# basic_bus_tracker.py
import requests
import json
import time
from datetime import datetime

class SimpleBusTracker:
    def __init__(self):
        self.base_url = "https://api.buskita.com"
        self.headers = {
            'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)',
            'Accept': 'application/json'
        }
    
    def get_active_buses(self):
        """å…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¹ã‚’å–å¾—"""
        url = f"{self.base_url}/get-buses"
        params = {'language': 1, 'siteId': 9}  # æ»‹è³€å¸ç”£ãƒã‚¹
        
        try:
            response = requests.get(url, params=params, headers=self.headers)
            return response.json()
        except Exception as e:
            print(f"ã‚¨ãƒ©ãƒ¼: {e}")
            return None
    
    def track_bus(self, work_no):
        """ç‰¹å®šãƒã‚¹ã®ä½ç½®ã‚’è¿½è·¡"""
        url = f"{self.base_url}/get-bus"
        params = {
            'language': 1,
            'siteId': 9,
            'workNo': work_no
        }
        
        try:
            response = requests.get(url, params=params, headers=self.headers)
            data = response.json()
            
            if data and len(data) > 0:
                bus = data[0]
                print(f"ãƒã‚¹ {work_no}:")
                print(f"  ä½ç½®: ({bus['lat']}, {bus['lng']})")
                print(f"  æ›´æ–°æ™‚åˆ»: {bus['updateTime']}")
                print(f"  é€Ÿåº¦: {bus.get('speed', 'N/A')} km/h")
                
            return data
        except Exception as e:
            print(f"ã‚¨ãƒ©ãƒ¼: {e}")
            return None

# ä½¿ç”¨ä¾‹
if __name__ == "__main__":
    tracker = SimpleBusTracker()
    
    # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒã‚¹ã‚’å–å¾—
    buses = tracker.get_active_buses()
    if buses:
        print(f"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒã‚¹æ•°: {len(buses)}")
        
        # æœ€åˆã®ãƒã‚¹ã‚’è¿½è·¡
        if len(buses) > 0:
            work_no = buses[0]['workNo']
            tracker.track_bus(work_no)
```

### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ã®è¿½åŠ 

ä½ç½®ãƒ‡ãƒ¼ã‚¿ã‚’ç¶™ç¶šçš„ã«ä¿å­˜ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```python
# data_logger.py
import sqlite3
import json
from datetime import datetime

class BusDataLogger:
    def __init__(self, db_path="bus_data.db"):
        self.db_path = db_path
        self.init_database()
    
    def init_database(self):
        """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS bus_positions (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                work_no INTEGER,
                device_uid TEXT,
                latitude REAL,
                longitude REAL,
                speed REAL,
                direction REAL,
                update_time TEXT,
                recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        conn.commit()
        conn.close()
    
    def save_position(self, bus_data):
        """ãƒã‚¹ä½ç½®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO bus_positions 
            (work_no, device_uid, latitude, longitude, speed, direction, update_time)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', (
            bus_data.get('workNo'),
            bus_data.get('device_uid'),
            bus_data.get('lat'),
            bus_data.get('lng'),
            bus_data.get('speed'),
            bus_data.get('direction'),
            bus_data.get('updateTime')
        ))
        
        conn.commit()
        conn.close()
```

## ğŸš€ é«˜åº¦ãªæ©Ÿèƒ½å®Ÿè£…

### ã‚¹ãƒ†ãƒƒãƒ—6: Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŒ–

Flaskã¾ãŸã¯FastAPIã‚’ä½¿ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```python
# web_app.py
from flask import Flask, render_template, jsonify
import json

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/buses')
def get_buses():
    tracker = SimpleBusTracker()
    buses = tracker.get_active_buses()
    return jsonify(buses)

@app.route('/api/bus/<int:work_no>')
def get_bus(work_no):
    tracker = SimpleBusTracker()
    bus_data = tracker.track_bus(work_no)
    return jsonify(bus_data)

if __name__ == '__main__':
    app.run(debug=True)
```

### ã‚¹ãƒ†ãƒƒãƒ—7: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ°å›³è¡¨ç¤º

åœ°å›³è¡¨ç¤ºã«ã¯è¤‡æ•°ã®é¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œãã‚Œã®ç‰¹å¾´ã¨å®Ÿè£…æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: Leaflet.jsï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ»ç„¡æ–™ï¼‰

```html
<!-- templates/index_leaflet.html -->
<!DOCTYPE html>
<html>
<head>
    <title>ãƒã‚¹ä½ç½®è¿½è·¡ã‚¢ãƒ—ãƒª - Leafletç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <div id="map" style="height: 500px;"></div>
    
    <script>
        // åœ°å›³ã®åˆæœŸåŒ–
        var map = L.map('map').setView([35.0116, 135.7681], 10);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        var busMarkers = {};
        
        // ãƒã‚¹ä½ç½®ã®æ›´æ–°
        function updateBusPositions() {
            fetch('/api/buses')
                .then(response => response.json())
                .then(buses => {
                    buses.forEach(bus => {
                        const markerId = `bus_${bus.workNo}`;
                        
                        // æ—¢å­˜ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
                        if (busMarkers[markerId]) {
                            map.removeLayer(busMarkers[markerId]);
                        }
                        
                        // æ–°ã—ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
                        busMarkers[markerId] = L.marker([bus.lat, bus.lng])
                            .addTo(map)
                            .bindPopup(`
                                <b>ãƒã‚¹ ${bus.workNo}</b><br>
                                é€Ÿåº¦: ${bus.speed || 'N/A'} km/h<br>
                                æ›´æ–°: ${bus.updateTime}
                            `);
                    });
                });
        }
        
        // 30ç§’ã”ã¨ã«æ›´æ–°
        setInterval(updateBusPositions, 30000);
        updateBusPositions();
    </script>
</body>
</html>
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: Google Maps APIï¼ˆé«˜æ©Ÿèƒ½ãƒ»æœ‰æ–™ï¼‰

Google Maps APIã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã‚ˆã‚Šé«˜åº¦ãªæ©Ÿèƒ½ã¨æ—¥æœ¬èªå¯¾å¿œãŒåˆ©ç”¨ã§ãã¾ã™ã€‚

**äº‹å‰æº–å‚™:**
1. [Google Cloud Console](https://console.cloud.google.com/)ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. Maps JavaScript APIã‚’æœ‰åŠ¹åŒ–
3. APIã‚­ãƒ¼ã‚’å–å¾—ï¼ˆè«‹æ±‚å…ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ï¼‰

```html
<!-- templates/index_googlemaps.html -->
<!DOCTYPE html>
<html>
<head>
    <title>ãƒã‚¹ä½ç½®è¿½è·¡ã‚¢ãƒ—ãƒª - Google Mapsç‰ˆ</title>
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
        .info-window {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <script>
        let map;
        let busMarkers = {};
        
        // åœ°å›³ã®åˆæœŸåŒ–
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: { lat: 35.0116, lng: 135.7681 }, // æ»‹è³€çœŒå¤§æ´¥å¸‚
                mapTypeId: 'roadmap',
                styles: [
                    // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                    {
                        featureType: 'transit',
                        elementType: 'labels.icon',
                        stylers: [{ visibility: 'on' }]
                    }
                ]
            });
            
            // åˆå›ãƒã‚¹ä½ç½®æ›´æ–°
            updateBusPositions();
            
            // 30ç§’ã”ã¨ã«æ›´æ–°
            setInterval(updateBusPositions, 30000);
        }
        
        // ãƒã‚¹ä½ç½®ã®æ›´æ–°
        function updateBusPositions() {
            fetch('/api/buses')
                .then(response => response.json())
                .then(buses => {
                    buses.forEach(bus => {
                        const markerId = `bus_${bus.workNo}`;
                        
                        // æ—¢å­˜ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
                        if (busMarkers[markerId]) {
                            busMarkers[markerId].setMap(null);
                        }
                        
                        // ãƒã‚¹ã‚¢ã‚¤ã‚³ãƒ³ã®ä½œæˆ
                        const busIcon = {
                            url: createBusIcon(bus.direction || 0),
                            scaledSize: new google.maps.Size(32, 32),
                            anchor: new google.maps.Point(16, 16)
                        };
                        
                        // æ–°ã—ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
                        const marker = new google.maps.Marker({
                            position: { lat: bus.lat, lng: bus.lng },
                            map: map,
                            title: `ãƒã‚¹ ${bus.workNo}`,
                            icon: busIcon,
                            animation: google.maps.Animation.DROP
                        });
                        
                        // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½œæˆ
                        const infoWindow = new google.maps.InfoWindow({
                            content: `
                                <div class="info-window">
                                    <h3>ğŸšŒ ãƒã‚¹ ${bus.workNo}</h3>
                                    <p><strong>ä½ç½®:</strong> ${bus.lat.toFixed(6)}, ${bus.lng.toFixed(6)}</p>
                                    <p><strong>é€Ÿåº¦:</strong> ${bus.speed || 'N/A'} km/h</p>
                                    <p><strong>æ–¹å‘:</strong> ${bus.direction || 'N/A'}Â°</p>
                                    <p><strong>æ›´æ–°æ™‚åˆ»:</strong> ${bus.updateTime}</p>
                                </div>
                            `
                        });
                        
                        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                        marker.addListener('click', () => {
                            // ä»–ã®æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹
                            Object.values(busMarkers).forEach(m => {
                                if (m.infoWindow) {
                                    m.infoWindow.close();
                                }
                            });
                            
                            infoWindow.open(map, marker);
                        });
                        
                        marker.infoWindow = infoWindow;
                        busMarkers[markerId] = marker;
                    });
                })
                .catch(error => {
                    console.error('ãƒã‚¹ä½ç½®ã®å–å¾—ã«å¤±æ•—:', error);
                });
        }
        
        // ãƒã‚¹æ–¹å‘ã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆ
        function createBusIcon(direction) {
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const ctx = canvas.getContext('2d');
            
            // èƒŒæ™¯å††
            ctx.fillStyle = '#4285F4';
            ctx.beginPath();
            ctx.arc(16, 16, 14, 0, 2 * Math.PI);
            ctx.fill();
            
            // ãƒã‚¹ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸšŒ', 16, 20);
            
            return canvas.toDataURL();
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.gm_authFailure = function() {
            alert('Google Maps APIã®èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        };
    </script>
    
    <!-- Google Maps APIèª­ã¿è¾¼ã¿ -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap&language=ja&region=JP">
    </script>
</body>
</html>
```

**Flaskå´ã®å¯¾å¿œ:**

```python
# web_app.py ã«è¿½åŠ 
import os

@app.route('/googlemaps')
def googlemaps():
    api_key = os.environ.get('GOOGLE_MAPS_API_KEY', 'YOUR_API_KEY')
    return render_template('index_googlemaps.html', api_key=api_key)

# ç’°å¢ƒå¤‰æ•°ã§APIã‚­ãƒ¼ã‚’ç®¡ç†
# export GOOGLE_MAPS_API_KEY="your_actual_api_key_here"
```

#### åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ¯”è¼ƒ

| æ©Ÿèƒ½ | Leaflet.js | Google Maps |
|------|------------|-------------|
| **ã‚³ã‚¹ãƒˆ** | ç„¡æ–™ | æœ‰æ–™ï¼ˆæœˆ$200ã¾ã§ç„¡æ–™æ ã‚ã‚Šï¼‰ |
| **æ—¥æœ¬èªå¯¾å¿œ** | åŸºæœ¬çš„ | å®Œå…¨å¯¾å¿œ |
| **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§** | é«˜ã„ | ä¸­ç¨‹åº¦ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | è»½é‡ | é«˜æ©Ÿèƒ½ã ãŒé‡ã„ |
| **äº¤é€šæƒ…å ±** | ãªã— | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äº¤é€šæƒ…å ± |
| **ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼** | ãªã— | å¯¾å¿œ |
| **ãƒ«ãƒ¼ãƒˆæ¤œç´¢** | åˆ¥é€”APIå¿…è¦ | æ¨™æº–å¯¾å¿œ |

#### æ¨å¥¨äº‹é …

- **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒ»å€‹äººåˆ©ç”¨**: Leaflet.js
- **å•†ç”¨ãƒ»é«˜æ©Ÿèƒ½ãŒå¿…è¦**: Google Maps API
- **äºˆç®—é‡è¦–**: Leaflet.js + OpenStreetMap
- **æ—¥æœ¬ç‰¹åŒ–**: Google Maps API

#### Google Maps API é«˜åº¦ãªæ©Ÿèƒ½

Google Maps APIã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®è¿½åŠ æ©Ÿèƒ½ä¾‹ï¼š

```javascript
// äº¤é€šæƒ…å ±ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 
const trafficLayer = new google.maps.TrafficLayer();
trafficLayer.setMap(map);

// å…¬å…±äº¤é€šæ©Ÿé–¢ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 
const transitLayer = new google.maps.TransitLayer();
transitLayer.setMap(map);

// ãƒã‚¹åœã®è¡¨ç¤ºï¼ˆPlaces APIä½¿ç”¨ï¼‰
function showBusStops() {
    const service = new google.maps.places.PlacesService(map);
    
    service.nearbySearch({
        location: map.getCenter(),
        radius: 5000,
        type: 'bus_station'
    }, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
            results.forEach(place => {
                new google.maps.Marker({
                    position: place.geometry.location,
                    map: map,
                    title: place.name,
                    icon: {
                        url: 'https://maps.google.com/mapfiles/ms/icons/bus.png',
                        scaledSize: new google.maps.Size(24, 24)
                    }
                });
            });
        }
    });
}

// ãƒ«ãƒ¼ãƒˆè¡¨ç¤ºï¼ˆDirections APIä½¿ç”¨ï¼‰
function showRoute(origin, destination) {
    const directionsService = new google.maps.DirectionsService();
    const directionsRenderer = new google.maps.DirectionsRenderer({
        suppressMarkers: true,
        polylineOptions: {
            strokeColor: '#FF0000',
            strokeWeight: 4
        }
    });
    
    directionsRenderer.setMap(map);
    
    directionsService.route({
        origin: origin,
        destination: destination,
        travelMode: google.maps.TravelMode.TRANSIT,
        transitOptions: {
            modes: [google.maps.TransitMode.BUS]
        }
    }, (result, status) => {
        if (status === 'OK') {
            directionsRenderer.setDirections(result);
        }
    });
}

// ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆãƒã‚¹å¯†åº¦ï¼‰
function showBusHeatmap(busData) {
    const heatmapData = busData.map(bus => ({
        location: new google.maps.LatLng(bus.lat, bus.lng),
        weight: bus.speed || 1
    }));
    
    const heatmap = new google.maps.visualization.HeatmapLayer({
        data: heatmapData,
        map: map
    });
}
```

#### APIã‚­ãƒ¼ã®è¨­å®šã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```bash
# ç’°å¢ƒå¤‰æ•°ã§ã®è¨­å®š
export GOOGLE_MAPS_API_KEY="your_api_key_here"

# .env ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç®¡ç†
echo "GOOGLE_MAPS_API_KEY=your_api_key_here" > .env
```

```python
# Python-dotenv ã‚’ä½¿ç”¨
from dotenv import load_dotenv
import os

load_dotenv()
GOOGLE_MAPS_API_KEY = os.getenv('GOOGLE_MAPS_API_KEY')

@app.route('/config')
def get_config():
    return jsonify({
        'google_maps_api_key': GOOGLE_MAPS_API_KEY
    })
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- APIã‚­ãƒ¼ã®åˆ¶é™è¨­å®šï¼ˆHTTP ãƒªãƒ•ã‚¡ãƒ©ãƒ¼ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
- å¿…è¦ãªAPIã®ã¿ã‚’æœ‰åŠ¹åŒ–
- ä½¿ç”¨é‡ã®ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

### ã‚¹ãƒ†ãƒƒãƒ—8: é€šçŸ¥æ©Ÿèƒ½ã®å®Ÿè£…

ãƒã‚¹ã®é…å»¶ã‚„åˆ°ç€äºˆå®šæ™‚åˆ»ã®é€šçŸ¥æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```python
# notification_system.py
import smtplib
from email.mime.text import MIMEText
from datetime import datetime, timedelta

class BusNotificationSystem:
    def __init__(self):
        self.subscribers = []
    
    def add_subscriber(self, email, bus_stop, work_no):
        """é€šçŸ¥è³¼èª­è€…ã‚’è¿½åŠ """
        self.subscribers.append({
            'email': email,
            'bus_stop': bus_stop,
            'work_no': work_no
        })
    
    def check_arrival_time(self, work_no, target_stop):
        """åˆ°ç€äºˆå®šæ™‚åˆ»ã‚’ãƒã‚§ãƒƒã‚¯"""
        # ãƒã‚¹ä½ç½®ã¨åœç•™æ‰€æƒ…å ±ã‹ã‚‰åˆ°ç€æ™‚åˆ»ã‚’è¨ˆç®—
        # å®Ÿè£…ã¯çœç•¥
        pass
    
    def send_notification(self, email, message):
        """ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡"""
        # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®å®Ÿè£…
        pass
```

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ã‚¹ãƒ†ãƒƒãƒ—9: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤

#### Herokuãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# Procfile
web: python web_app.py

# requirements.txt ã«è¿½åŠ 
gunicorn==20.1.0
```

#### DockeråŒ–
```dockerfile
# Dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 5000

CMD ["python", "web_app.py"]
```

### ã‚¹ãƒ†ãƒƒãƒ—10: ç›£è¦–ã¨ãƒ­ã‚°

```python
# monitoring.py
import logging
from datetime import datetime

class BusAppMonitor:
    def __init__(self):
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler('bus_app.log'),
                logging.StreamHandler()
            ]
        )
        self.logger = logging.getLogger(__name__)
    
    def log_api_call(self, endpoint, status_code, response_time):
        """APIå‘¼ã³å‡ºã—ã‚’ãƒ­ã‚°"""
        self.logger.info(f"API Call: {endpoint} - Status: {status_code} - Time: {response_time}ms")
    
    def log_error(self, error_message):
        """ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°"""
        self.logger.error(f"Error: {error_message}")
```

## ğŸ“š å‚è€ƒè³‡æ–™

### ç ”ç©¶ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [API_USAGE_SUMMARY.md](./API_USAGE_SUMMARY.md) - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è©³ç´°ä½¿ç”¨æ–¹æ³•
- [ãƒã‚¹IDå–å¾—å®Œå…¨ã‚¬ã‚¤ãƒ‰.md](./ãƒã‚¹IDå–å¾—å®Œå…¨ã‚¬ã‚¤ãƒ‰.md) - ãƒã‚¹è­˜åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨è§£èª¬
- [ãƒã‚¹ã‚­ã‚¿ã‚¢ãƒ—ãƒªæŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ.md](./ãƒã‚¹ã‚­ã‚¿ã‚¢ãƒ—ãƒªæŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ.md) - æŠ€è¡“ä»•æ§˜ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ†æ

### ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/bus_location_tracker.py` - åŸºæœ¬çš„ãªãƒã‚¹ä½ç½®è¿½è·¡
- `scripts/bus_id_explorer.py` - ãƒã‚¹IDæ¢ç´¢ãƒ„ãƒ¼ãƒ«
- `scripts/bus_monitor.py` - ãƒã‚¹ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
- `scripts/buskita_api_usage_guide.py` - APIä½¿ç”¨ã‚¬ã‚¤ãƒ‰

### ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«
- `data/api_responses/` - å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
- `data/raw_data/` - å®Ÿéš›ã®ãƒã‚¹ä½ç½®ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **åŸºæœ¬æ©Ÿèƒ½ã®å®Ÿè£…**: ã¾ãšç°¡å˜ãªãƒã‚¹è¿½è·¡ã‹ã‚‰å§‹ã‚ã‚‹
2. **ãƒ‡ãƒ¼ã‚¿è“„ç©**: ç¶™ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿åé›†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰
3. **åˆ†ææ©Ÿèƒ½**: é…å»¶ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„é‹è¡ŒåŠ¹ç‡ã®åˆ†æ
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ç›´æ„Ÿçš„ãªUIã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
5. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: è¤‡æ•°ãƒã‚¹ä¼šç¤¾ã¸ã®å¯¾å¿œ

## âš ï¸ æ³¨æ„äº‹é …

- **åˆ©ç”¨è¦ç´„ã®éµå®ˆ**: å„ãƒã‚¹ä¼šç¤¾ã®APIåˆ©ç”¨è¦ç´„ã‚’å¿…ãšç¢ºèª
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: APIå‘¼ã³å‡ºã—é »åº¦ã‚’é©åˆ‡ã«åˆ¶é™
- **ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: å€‹äººæƒ…å ±ã®é©åˆ‡ãªå–ã‚Šæ‰±ã„
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å®Ÿè£…

## ğŸ¤ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç ”ç©¶ãƒ»æ•™è‚²ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚æ”¹å–„ææ¡ˆã‚„ãƒã‚°å ±å‘Šã¯æ­“è¿ã—ã¾ã™ã€‚

---

**Happy Coding! ğŸšŒâœ¨** 